{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tiện nghi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="{% static 'app/css/tiennghii.css' %}">
</head>
<body>
<div class="start-container">

    <div class="start-header fixed-header">
        <a href="{% url 'home' %}">
            <img src="{% static 'app/images/logo.jpg' %}" alt="logo">
        </a>
        <div class="header-actions">
            <button class="btn batnThacMac">Bạn có thắc mắc?</button>
            <button class="btn btnLuuThoat">Lưu và thoát</button>
        </div>
    </div>

    <form method="post" id="amenities-form">
        {% csrf_token %}
        <div class="start-main scroll-area">
            <h1 class="question">Cho khách biết chỗ ở của bạn có những gì</h1>

            <!-- Tiện nghi cơ bản -->
            <h3 class="subtitle">Bạn có những tiện nghi yêu thích của khách nào sau đây?</h3>
            <div class="options-grid">
                {% for amenity in basic_amenities %}
                <div class="option-item" data-amenity-id="{{ amenity.amenity_id }}">
                    <i class="{{ amenity.icon|default:'fas fa-check-circle' }} icon"></i>
                    <p>{{ amenity.name }}</p>
                </div>
                {% empty %}
                <p class="text-muted">Chưa có tiện nghi cơ bản.</p>
                {% endfor %}
            </div>

            <!-- Tiện nghi nổi bật -->
            <h3 class="subtitle">Bạn có tiện nghi nào nổi bật không?</h3>
            <div class="options-grid">
                {% for amenity in featured_amenities %}
                <div class="option-item" data-amenity-id="{{ amenity.amenity_id }}">
                    <i class="{{ amenity.icon|default:'fas fa-star' }} icon"></i>
                    <p>{{ amenity.name }}</p>
                </div>
                {% empty %}
                <p class="text-muted">Chưa có tiện nghi nổi bật.</p>
                {% endfor %}
            </div>

            <!-- Tiện nghi an toàn -->
            <h3 class="subtitle">Bạn có tiện nghi nào trong số những tiện nghi đảm bảo an toàn sau đây không?</h3>
            <div class="options-grid">
                {% for amenity in safety_amenities %}
                <div class="option-item" data-amenity-id="{{ amenity.amenity_id }}">
                    <i class="{{ amenity.icon|default:'fas fa-shield-halved' }} icon"></i>
                    <p>{{ amenity.name }}</p>
                </div>
                {% empty %}
                <p class="text-muted">Chưa có tiện nghi an toàn.</p>
                {% endfor %}
            </div>
        </div>

        <!-- Hidden inputs để lưu các tiện nghi đã chọn -->
        <div id="selected-amenities-container"></div>

        <div class="start-footer fixed-footer">
            <a href="{% url 'buoc2' %}" class="back-link">Quay lại</a>
            <button type="submit" class="next-btn">Tiếp theo</button>
        </div>
    </form>
</div>

</body>
<script>
  // Lấy tất cả ô tiện nghi
  const items = document.querySelectorAll('.option-item');
  const form = document.getElementById('amenities-form');
  const container = document.getElementById('selected-amenities-container');

  // Thiết lập toggle chọn / bỏ chọn cho từng ô
  items.forEach(item => {
    // cho phép focus + keyboard (tốt cho accessibility)
    item.setAttribute('tabindex', '0');
    item.setAttribute('role', 'button');
    item.setAttribute('aria-pressed', 'false');

    const toggle = () => {
      item.classList.toggle('selected');
      const selected = item.classList.contains('selected');
      item.setAttribute('aria-pressed', selected ? 'true' : 'false');
      updateHiddenInputs();
    };

    // Click chuột
    item.addEventListener('click', toggle);

    // Hỗ trợ phím Enter / Space khi focus
    item.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggle();
      }
    });
  });

  // Cập nhật hidden inputs dựa trên các tiện nghi đã chọn
  function updateHiddenInputs() {
    // Xóa tất cả hidden inputs cũ
    container.innerHTML = '';
    
    // Thêm hidden input cho mỗi tiện nghi được chọn
    const selectedItems = document.querySelectorAll('.option-item.selected');
    selectedItems.forEach(item => {
      const amenityId = item.getAttribute('data-amenity-id');
      if (amenityId) {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'amenities';
        input.value = amenityId;
        container.appendChild(input);
      }
    });
  }
</script>

</html>