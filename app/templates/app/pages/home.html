{% extends 'app/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Nơi lưu trú{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'app/css/home.css' %}">
{% endblock %}

{% block content %}

    <section class="section cards-section popular-city">
        <div class="section-header">
            <h2>Nơi lưu trú được ưa chuộng tại Hồ Chí Minh ›</h2>
            <div class="slider-controls">
                <button class="slide-btn left" onclick="slideLeft(this)">❮</button>
                <button class="slide-btn right" onclick="slideRight(this)">❯</button>
            </div>
        </div>
        <div class="cards-wrapper">
            <div class="cards-row">
                {% for item in hcm_listings %}
                <div class="card" data-room-id="{{ item.listing_id }}">
                    {% with item.images.all|first as first_img %}
                        <img src="{{ first_img.image_url }}" alt="{{ item.title }}">
                    {% endwith %}
                    <div class="popular-badge">Được khách yêu thích</div>
                    <div class="card-heart"><i class="fa-regular fa-heart"></i></div>
                    <h4>{{ item.title }}</h4>
                    <p class="meta">₫{{ item.price_per_night|floatformat:0|intcomma }} / đêm · ★5,0</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <section class="section cards-section">
        <div class="section-header">
            <h2>Còn phòng tại Hà Nội vào tháng tới ›</h2>
            <div class="slider-controls">
                <button class="slide-btn left" onclick="slideLeft(this)">❮</button>
                <button class="slide-btn right" onclick="slideRight(this)">❯</button>
            </div>
        </div>
        <div class="cards-wrapper">
            <div class="cards-row">
                {% for item in hanoi_listings %}
                <div class="card" data-room-id="{{ item.listing_id }}">
                    {% with item.images.all|first as first_img %}
                        <img src="{{ first_img.image_url }}" alt="{{ item.title }}">
                    {% endwith %}
                    <div class="popular-badge">Được khách yêu thích</div>
                    <div class="card-heart"><i class="fa-regular fa-heart"></i></div>
                    <h4>{{ item.title }}</h4>
                    <p class="meta">₫{{ item.price_per_night|floatformat:0|intcomma }} / đêm · ★{{ item.rating|default:"5,0" }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <section class="section cards-section">
        <div class="section-header">
            <h2>Còn phòng tại Đà Lạt vào cuối tuần này ›</h2>
            <div class="slider-controls">
                <button class="slide-btn left" onclick="slideLeft(this)">❮</button>
                <button class="slide-btn right" onclick="slideRight(this)">❯</button>
            </div>
        </div>
        <div class="cards-wrapper">
            <div class="cards-row">
                {% for item in dalat_listings %}
                <div class="card" data-room-id="{{ item.listing_id }}">
                    {% with item.images.all|first as first_img %}
                        <img src="{{ first_img.image_url }}" alt="{{ item.title }}">
                    {% endwith %}
                    <div class="popular-badge">Được khách yêu thích</div>
                    <div class="card-heart"><i class="fa-regular fa-heart"></i></div>
                    <h4>{{ item.title }}</h4>
                    <p class="meta">₫{{ item.price_per_night|floatformat:0|intcomma }} / đêm · ★5,0</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <section class="section cards-section">
        <div class="section-header">
            <h2>Còn phòng tại Đà Nẵng vào tháng tới ›</h2>
            <div class="slider-controls">
                <button class="slide-btn left" onclick="slideLeft(this)">❮</button>
                <button class="slide-btn right" onclick="slideRight(this)">❯</button>
            </div>
        </div>
        <div class="cards-wrapper">
            <div class="cards-row">
                {% for item in danang_listings %}
                <div class="card" data-room-id="{{ item.listing_id }}">
                    {% with item.images.all|first as first_img %}
                        <img src="{{ first_img.image_url }}" alt="{{ item.title }}">
                    {% endwith %}
                    <div class="popular-badge">Được khách yêu thích</div>
                    <div class="card-heart"><i class="fa-regular fa-heart"></i></div>
                    <h4>{{ item.title }}</h4>
                    <p class="meta">₫{{ item.price_per_night|floatformat:0|intcomma }} / đêm · ★5,0</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <section class="section cards-section">
        <div class="section-header">
            <h2>Nơi lưu trú được ưa chuộng tại Huyện Văn Giang ›</h2>
            <div class="slider-controls">
                <button class="slide-btn left" onclick="slideLeft(this)">❮</button>
                <button class="slide-btn right" onclick="slideRight(this)">❯</button>
            </div>
        </div>
        <div class="cards-wrapper">
            <div class="cards-row">
                {% for item in vangiang_listings %}
                <div class="card" data-room-id="{{ item.listing_id }}">
                    {% with item.images.all|first as first_img %}
                        <img src="{{ first_img.image_url }}" alt="{{ item.title }}">
                    {% endwith %}
                    <div class="popular-badge">Được khách yêu thích</div>
                    <div class="card-heart"><i class="fa-regular fa-heart"></i></div>
                    <h4>{{ item.title }}</h4>
                    <p class="meta">₫{{ item.price_per_night|floatformat:0|intcomma }} / đêm · ★5,0</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <section class="section cards-section">
        <div class="section-header">
            <h2>Các nơi lưu trú khác ›</h2>
            <div class="slider-controls">
                <button class="slide-btn left" onclick="slideLeft(this)">❮</button>
                <button class="slide-btn right" onclick="slideRight(this)">❯</button>
            </div>
        </div>
        <div class="cards-wrapper">
            <div class="cards-row">
                {% for item in other_listings %}
                <div class="card" data-room-id="{{ item.listing_id }}">
                    {% with item.images.all|first as first_img %}
                        <img src="{{ first_img.image_url }}" alt="{{ item.title }}">
                    {% endwith %}
                    <div class="popular-badge">Được khách yêu thích</div>
                    <div class="card-heart"><i class="fa-regular fa-heart"></i></div>
                    <h4>{{ item.title }}</h4>
                    <p class="meta">₫{{ item.price_per_night|floatformat:0|intcomma }} / đêm · ★5,0</p>
                </div>
                {% empty %}
                <p style="padding: 12px; color: #666;">Chưa có bài đăng ngoài các thành phố nổi bật.</p>
                {% endfor %}
            </div>
        </div>
    </section>

{% endblock %}

{% block extra_js %}
<script src="{% static 'app/js/luotcard.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const cards = document.querySelectorAll('.card');
        cards.forEach((card) => {
            card.style.cursor = 'pointer';
            card.addEventListener('click', function(e) {
                if (e.target.closest('.card-heart')) return;
                // Lấy ID thật từ database
                const roomId = this.getAttribute('data-room-id');
                const url = "{% url 'chitietnoio' %}?room=" + roomId;
                window.open(url, '_blank');
            });
        });
    });
</script>
{% endblock %}