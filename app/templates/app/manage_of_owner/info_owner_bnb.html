{% extends 'app/manage_of_owner/base.html' %}

{% block owner_content %}
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Thông tin chỗ ở: {{ listing.title }}</h2>
    <div>
      <a class="btn btn-sm btn-outline-secondary" href="{% url 'owner_listings' %}">Quay lại danh sách</a>
      <a class="btn btn-sm btn-primary" href="{% url 'add_new_bnb' %}">Chỉnh sửa</a>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-8">
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title">Mô tả</h5>
          <p class="card-text">{{ listing.description }}</p>
          <p class="mb-0"><strong>Giá / đêm:</strong> {{ listing.price_per_night }}</p>
          <p><strong>Số người:</strong> {{ listing.max_adults }} người</p>
        </div>
      </div>

      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title">Địa chỉ</h5>
          {% if listing.listingaddress %}
            <p>{{ listing.listingaddress.street }}, {{ listing.listingaddress.district }}, {{ listing.listingaddress.city }}</p>
          {% else %}
            <p class="text-muted">Chưa có địa chỉ</p>
          {% endif %}
        </div>
      </div>

      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Tiện nghi</h5>
          <ul class="list-inline mb-0">
            {% for a in amenities %}
              <li class="list-inline-item badge bg-light text-dark border">{{ a.name }}</li>
            {% empty %}
              <li class="text-muted">Không có tiện nghi nào</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card mb-3">
        <div class="card-body">
          <h6 class="card-subtitle mb-2 text-muted">Thống kê</h6>
          <p class="mb-1"><strong>Tổng đơn:</strong> {{ total_bookings }}</p>
          <p class="mb-1"><strong>Doanh thu ước tính:</strong> {{ total_earnings }}</p>
          <p class="mb-0"><strong>Đánh giá TB:</strong> {{ avg_rating|default:'-' }}</p>
        </div>
      </div>

      <div class="card">
        <div class="card-body">
          <h6 class="card-subtitle mb-2 text-muted">Sắp tới</h6>
          {% if upcoming_bookings %}
            <ul class="list-unstyled small mb-0">
              {% for b in upcoming_bookings %}
                <li>{{ b.check_in }} → {{ b.check_out }} — {{ b.user.get_full_name|default:b.user.username }}</li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted small">Không có booking sắp tới</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Tin nhắn gần đây</h5>
      {% if recent_messages %}
        <ul class="list-group list-group-flush">
          {% for m in recent_messages %}
            <li class="list-group-item">
              <strong>{{ m.sender.get_full_name|default:m.sender.username }}</strong>
              <div class="small text-muted">{{ m.created_at|default:m.created_at }}</div>
              <div>{{ m.content|truncatechars:200 }}</div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted">Không có tin nhắn nào.</p>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}
